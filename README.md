[![PureScript](https://raw.githubusercontent.com/purescript/purescript/master/logo.png)](http://purescript.org)

A small strongly typed programming language with expressive types that compiles to Javascript, written in and inspired by Haskell.

**Pure14** is an experimental C++14 compiler/backend for [PureScript](https://github.com/purescript/purescript). It attempts to generate "sane" and performant C++14 code (instead of JavaScript), in the spirit of PureScript.

#### Status:

* Alpha (0.2) — very early, contributions welcome!

#### Performance

* No runtime system (beyond the standard C++14 runtime library)
* Uses template metaprogramming extensively to translate the original source type information — minimal performance cost when running
* Uses native C++14 reference counting (`std::shared_ptr`) for relatively lightweight automatic memory management
* Uses PureScript's normal tail call optimizations for generated C++14 code

#### Differences from PureScript:

* Foreign imports are C++14 instead of JavaScript
* Compiler is `pcc` instead of `psc` or `psc-make`, and only supports `make` mode
  - Generates a simple CMake file for easy experimentation
* No Pure14-specific REPL right now

#### Other notes:

* Built-in lists use a custom, STL-like `shared_list` (immutable list) type
  - Built-in conversions to `std::vector`
  - Built-in conversions to `std::string` for `Char` list
* `String` type corresponds to `std::string` (at least for now)
* `Number` is C++ `double` type, with `Double` and `Float` aliases (`Int` is C++ `int`)

#### TO-DO:

* Get automated builds/tests up and running ([underway](https://github.com/andyarvanitis/pure11/tree/pure11/examples/passing))
* Support for `type` in generator (e.g. generate C++14 `using`)
* Optimized `newtype` (some work already done, but disabled for now)
* "Magic do" (similar work already done in inliner and TCO code)
* Unicode (UTF-8) support for `String` (use code from my Idris backend)
* Lots of testing!

#### Future ideas:

* Nice facilities (modules) for concurrency/parallelism, using `std::thread`, etc. under the hood
* Compiler options for memory management
* `BigInt` via GNU GMP
* Stricter exports in C++ code
* Use C++ operator overloading where supported

#### Requirements

* Everything you need to build [PureScript](https://github.com/purescript/purescript)
* A C++14-capable toolchain, e.g. recent versions of clang, gcc
* Installed CMake is helpful (for the provided quickstart CMake file generated), though not required. You should be able to use your favorite C++ build system, tools, debuggers, etc., for the generated code.

#### Examples

**`hello.purs`**
```PureScript
module Main where
  import Console

  main = do
    print "Hello, world"
```

* `Main.hh`
```C++
// Generated by pcc version 0.2
#ifndef Main_HH
#define Main_HH

#include "PureScript/PureScript.hh"
#include "Console/Console.hh"
#include "Prelude/Prelude.hh"

namespace Main {
    using namespace PureScript;
    using namespace Console;
    using namespace Prelude;
    
    auto main() -> Prelude::Unit;
}

#endif // Main_HH
```

* `Main.cc`
```C++
// Generated by pcc version 0.2
#include "Main/Main.hh"

namespace Main {
    using namespace PureScript;
    using namespace Console;
    using namespace Prelude;
    
    auto main() -> Prelude::Unit {
        return Console::print<string>("Hello, world")();
    }
}

auto main(int, char *[]) -> int {
    Main::main();
    return 0;
}
```
**`fib.purs`**
```PureScript
module Main where
  import Console

  fib :: Int -> Int
  fib 0 = 0
  fib 1 = 1
  fib n = fib (n - 2) + fib (n - 1)

  main = do
    print (show (fib 10))
```

  * `Main.cc`
```C++
// Generated by pcc version 0.2
#include "Main/Main.hh"

namespace Main {
    using namespace PureScript;
    using namespace Prelude;
    using namespace Console;
    
    auto fib(int n) -> int {
        if (n == 0) {
            return 0;
        }
        if (n == 1) {
            return 1;
        }
        return fib(n - 2) + fib(n - 1);
    }
    auto main() -> Prelude::Unit {
        return Console::print<string>(Prelude::Show<int>::show(fib(10)))();
    }
}

auto main(int, char *[]) -> int {
    Main::main();
    return 0;
}
```
